<!DOCTYPE html>
<html>
<head>
  <title>Mini Browser with Back/Forward</title>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#f4f4f4;}
    header { background:#2196f3; color:white; padding:10px; display:flex; gap:10px; align-items:center;}
    #searchInput { flex:1; padding:10px; font-size:16px; border:none; outline:none;}
    #searchBtn, #homeBtn, #backBtn, #fwdBtn {
      padding:10px 15px; border:none; background:#0d8ae0; color:white; cursor:pointer; font-size:16px;
    }
    #results {
      background:white; max-height:200px; overflow-y:auto; border-bottom:1px solid #ccc;
      display:none; position:relative; z-index:5;
    }
    .result { padding:8px; cursor:pointer; border-bottom:1px solid #eee;}
    .result:hover { background:#f0f0f0;}
    iframe { width:100%; height:calc(100vh - 50px); border:none;}
    #home { padding:20px;}
    .bookmark { background:white; padding:10px; margin:5px 0; border:1px solid #ccc; display:flex;
      justify-content:space-between; align-items:center;}
    .bm-actions button { margin-left:5px;}
    #addBookmark { margin-top:20px; display:flex; gap:5px; flex-wrap:wrap;}
    #addBookmark input { padding:5px; flex:1;}
    #addBookmark button { padding:5px 10px;}
  </style>
</head>
<body>
  <header id="searchBarContainer">
    <button id="backBtn" title="Back">‚¨Ö</button>
    <button id="fwdBtn" title="Forward">‚û°</button>
    <input id="searchInput" type="text" placeholder="Type a site name..." />
    <button id="searchBtn">üîç</button>
    <button id="homeBtn" title="Go Home">üè†</button>
  </header>
  <div id="results"></div>

  <div id="home">
    <h2>My Bookmarks</h2>
    <div id="bookmarks"></div>
    <div id="addBookmark">
      <input type="text" id="bmName" placeholder="Bookmark name">
      <input type="text" id="bmURL" placeholder="https://example.com">
      <button id="saveBm">Add</button>
    </div>
  </div>

  <iframe id="viewer" style="display:none;"></iframe>

  <script>
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const resultsDiv = document.getElementById('results');
    const viewer = document.getElementById('viewer');
    const homeBtn = document.getElementById('homeBtn');
    const homePage = document.getElementById('home');
    const bookmarksDiv = document.getElementById('bookmarks');
    const saveBm = document.getElementById('saveBm');
    const bmName = document.getElementById('bmName');
    const bmURL = document.getElementById('bmURL');
    const backBtn = document.getElementById('backBtn');
    const fwdBtn = document.getElementById('fwdBtn');

    let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
    let historyStack = [];
    let historyIndex = -1;

    renderBookmarks();

    async function searchSites(query) {
      resultsDiv.innerHTML = '';
      resultsDiv.style.display = 'block';
      const guess = document.createElement('div');
      guess.className = 'result';
      guess.textContent = `${query}.com`;
      guess.onclick = () => loadSite(`https://${query}.com`);
      resultsDiv.appendChild(guess);

      try {
        const res = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_redirect=1`);
        const data = await res.json();
        if (data.RelatedTopics) {
          data.RelatedTopics.forEach(item => {
            if (item.FirstURL) {
              const div = document.createElement('div');
              div.className = 'result';
              div.textContent = item.Text;
              div.onclick = () => loadSite(item.FirstURL);
              resultsDiv.appendChild(div);
            }
          });
        }
      } catch {
        const e = document.createElement('div');
        e.className = 'result';
        e.textContent = 'Error loading suggestions.';
        resultsDiv.appendChild(e);
      }
    }

    function loadSite(url) {
      searchInput.value = url; // <-- NEW: update search bar with the actual link
      viewer.src = url;
      viewer.style.display = 'block';
      homePage.style.display = 'none';
      hideSuggestions();
      // Manage history
      if (historyIndex === -1 || historyStack[historyIndex] !== url) {
        historyStack = historyStack.slice(0, historyIndex + 1);
        historyStack.push(url);
        historyIndex++;
      }
    }

    function hideSuggestions() {
      resultsDiv.style.display = 'none';
    }

    function renderBookmarks() {
      bookmarksDiv.innerHTML = '';
      bookmarks.forEach((b, idx) => {
        const div = document.createElement('div');
        div.className = 'bookmark';
        const nameSpan = document.createElement('span');
        nameSpan.textContent = b.name;
        div.appendChild(nameSpan);

        const actions = document.createElement('div');
        actions.className = 'bm-actions';

        const openBtn = document.createElement('button');
        openBtn.textContent = 'Open';
        openBtn.onclick = () => loadSite(b.url);
        actions.appendChild(openBtn);

        const editBtn = document.createElement('button');
        editBtn.textContent = 'Edit';
        editBtn.onclick = () => editBookmark(idx);
        actions.appendChild(editBtn);

        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.onclick = () => deleteBookmark(idx);
        actions.appendChild(delBtn);

        div.appendChild(actions);
        bookmarksDiv.appendChild(div);
      });
    }

    function editBookmark(idx) {
      const bm = bookmarks[idx];
      const newName = prompt('Edit name:', bm.name);
      const newURL = prompt('Edit URL:', bm.url);
      if (newName && newURL) {
        bookmarks[idx] = { name: newName, url: newURL };
        saveBookmarks();
      }
    }

    function deleteBookmark(idx) {
      if (confirm('Delete this bookmark?')) {
        bookmarks.splice(idx, 1);
        saveBookmarks();
      }
    }

    function saveBookmarks() {
      localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
      renderBookmarks();
    }

    saveBm.onclick = () => {
      if (bmName.value && bmURL.value) {
        bookmarks.push({ name: bmName.value, url: bmURL.value });
        saveBookmarks();
        bmName.value = '';
        bmURL.value = '';
      }
    };

    searchBtn.onclick = () => {
      const query = searchInput.value.trim();
      if (query) searchSites(query);
    };

    searchInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') searchBtn.click();
    });

    homeBtn.onclick = () => {
      viewer.style.display = 'none';
      homePage.style.display = 'block';
      hideSuggestions();
    };

    document.addEventListener('click', e => {
      if (!searchInput.contains(e.target) && !resultsDiv.contains(e.target)) {
        hideSuggestions();
      }
    });

    backBtn.onclick = () => {
      if (historyIndex > 0) {
        historyIndex--;
        searchInput.value = historyStack[historyIndex]; // keep in sync
        viewer.src = historyStack[historyIndex];
      }
    };

    fwdBtn.onclick = () => {
      if (historyIndex < historyStack.length - 1) {
        historyIndex++;
        searchInput.value = historyStack[historyIndex]; // keep in sync
        viewer.src = historyStack[historyIndex];
      }
    };
  </script>
</body>
</html>
